<?xml version="1.0" encoding="UTF-8"?>
<beans:beans
       xmlns:beans="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns="http://www.springframework.org/schema/integration"
       xmlns:int-htpp="http://www.springframework.org/schema/integration/http"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/integration
       http://www.springframework.org/schema/integration/spring-integration.xsd
       http://www.springframework.org/schema/integration/http
       http://www.springframework.org/schema/integration/http/spring-integration-http.xsd">

    <beans:bean id="channelHandler" class="kg.infocom.util.ChannelHandler"/>


    <int-htpp:inbound-gateway
            supported-methods="GET"
            request-channel="requestChannel" 
            reply-channel="replyChannel"
            path="/services/{pin}"
            payload-expression="#pathVariables.pin">
        <int-htpp:request-mapping produces="application/json" consumes="application/json"/>
        <!--<int-htpp:request-mapping produces="application/json" consumes="application/json"/>
            auto-startup="false"
            view-name="person"
            mapped-response-headers="Return-Status, Return-Status-Msg, HTTP_RESPONSE_HEADERS"
        <int-htpp:header name="pin" expression="#pathVariables.pin"/>-->
    </int-htpp:inbound-gateway>



    <channel id="requestChannel"/>
    <channel id="replyChannel"/>

<!--    <beans:bean class="org.springframework.web.servlet.view.ContentNegotiatingViewResolver">
        <beans:property name="order" value="1" />
        <beans:property name="contentNegotiationManager">
            <beans:bean class="org.springframework.web.accept.ContentNegotiationManagerFactoryBean">
                <beans:property name="defaultContentType" value="application/xml"/>
                <beans:property name="favorParameter" value="true"/>
                <beans:property name="ignoreAcceptHeader" value="true" />
                <beans:property name="mediaTypes">
                    <beans:map>
                        <beans:entry key="json" value="application/json" />
                        <beans:entry key="xml" value="application/xml" />
                    </beans:map>
                </beans:property>
            </beans:bean>
        </beans:property>
    </beans:bean>
-->
    <service-activator input-channel="requestChannel"
                       output-channel="replyChannel"
                       ref="channelHandler"
                       method="getPersonDataByPin"/>

    <!--<service-activator input-channel="replyChannel" ref="channelHandler" method="printText"/>-->

</beans:beans>